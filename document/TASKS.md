# 双模式取件码管理工具 - 任务列表（TASKS，Android 优先）

说明:
- 需求以 `document/PRD.md` 为准
- 技术规范以 `document/TECH.md` 为准
- UI/UX 以 `document/UI_UX.md` 为准
- 本文件仅描述“做什么/验收什么”，不重复需求与技术细节

## 任务列表

### 任务1：范围冻结与里程碑拆分（P0）
- 明确一期范围：离线闭环优先；AI 仅保留客户端位点与 UI 占位（平台能力边界以 PRD 为准）
- 冻结 Android minSdk=33、ScreenUtil 自适应、提醒策略（inexact + 数据变更重排程）
- 验收：PRD/TECH/TASKS 三份文档一致，评审通过

### 任务2：项目初始化与工程骨架（P0）
- Flutter 工程创建（Flutter 3.38.5）
- GetX 路由/Bindings/模块目录结构落地
- ScreenUtil 全局初始化 + 尺寸使用规范落地（lint/代码 review 约束）
- 验收：Android 13 设备可启动并进入首页；基础路由跳转正常

### 任务3：本地数据库与数据访问层（P0）
- drift 建表：PickupItem / TemplateRule / ReminderSetting
- Repository 抽象与实现（避免 UI 直接访问 DAO）
- 迁移机制（schema versioning）与基础单测
- 验收：CRUD 可用；升级迁移可跑通

### 任务4：识别引擎 v1（P0）
- 内置规则：关键字库 + 正则模板；到期时间解析（常见格式/相对描述）
- 用户模板：示例文本保存→生成规则→测试→启用/停用
- 去重：防止同一短信反复触发导致重复记录
- 验收：用样本短信集跑通解析；失败可手动修正并保存模板提升命中

### 任务5：Android 短信自动识别接入（P0，Android 优先）
- 权限引导：READ_SMS / RECEIVE_SMS；Android 13 通知权限 POST_NOTIFICATIONS
- Kotlin Receiver 获取短信正文 → 传入 Flutter → 识别 → 入库
- 异常降级：权限缺失/厂商限制时引导用户使用“粘贴导入”
- 验收：真实短信到达后可自动生成待取记录；权限关闭后不崩溃且提示明确

### 任务6：核心页面与交互（P0）
- 列表：待取/已取/逾期/异常；搜索筛选；批量删除
- 详情：复制取件码、标记已取/异常、编辑字段、删除
- 手动添加/粘贴导入：解析预览 + 可修正 + 保存模板开关
- 验收：离线模式从“新增/导入→展示→提醒→标记已取→历史管理”可闭环

### 任务7：本地提醒（P0，低耗电）
- 提醒设置：到期前 N 时间 / 固定时段 / 免打扰
- 调度：inexact；仅在数据变更时统一重排程（新增/编辑/删除/标记已取）
- 验收：提醒按设置触发；标记已取后取消提醒；跨重启仍有效

### 任务8：桌面小组件（P0）
- home_widget 打通数据写入与刷新链路
- Android Widget：展示 1~3 条待取摘要；点击跳转记录详情
- iOS Widget：展示待取摘要（不依赖短信自动识别）
- 验收：组件展示与 App 列表一致；更新及时；隐私配置生效（隐藏码）

### 任务9：模式切换与数据隔离/迁移（P0）
- 离线/AI 数据域隔离（分库或逻辑隔离）
- 离线→AI：存在待取时提示导入（仅待取/全部）
- AI→离线：不自动回流（避免混用），可选导出待取为离线（需确认）
- 验收：切换不串数据；导入/导出结果正确；小组件与提醒随之更新

### 任务10：AI 模式客户端位点（P0，不含后端）
- domain 定义：AiExtractApi / GroupSyncApi 等接口
- data 实现：Fake/Mock（本地模拟）
- UI 占位：AI 模式入口、登录/小组页面占位、分享至小组交互（走 fake 同步验证流程）
- 验收：无后端情况下 AI 模式流程可演示；离线模式不会发起网络请求

### 任务11：测试与发布准备（P0）
- 单测：解析/到期计算/状态机/Repository
- 集成测试：Android 短信接入（模拟）、提醒触发、小组件刷新
- 合规：隐私政策、权限用途说明（短信/通知/悬浮窗如有）
- 验收：核心路径可回归；Android 13 真机内测包可交付
